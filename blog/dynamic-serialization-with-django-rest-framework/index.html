<!DOCTYPE html>
<html><head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Dynamic Serialization With Django Rest Framework - %_</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="How to create a drf serializer class dynamically using the type function" />
	<meta property="og:image" content=""/>
	<meta property="og:title" content="Dynamic Serialization With Django Rest Framework" />
<meta property="og:description" content="How to create a drf serializer class dynamically using the type function" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://michaelgainyo.github.io/blog/dynamic-serialization-with-django-rest-framework/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2023-01-09T23:18:45+01:00" />
<meta property="article:modified_time" content="2023-01-09T23:18:45+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dynamic Serialization With Django Rest Framework"/>
<meta name="twitter:description" content="How to create a drf serializer class dynamically using the type function"/>
<script src="https://michaelgainyo.github.io/js/feather.min.js"></script>
	
	
        <link href="https://michaelgainyo.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://michaelgainyo.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css" />

	
	

	
	
	
	
		
		
		<link rel="stylesheet" type="text/css" href="https://michaelgainyo.github.io/css/base.4d64f8cb88deada53cb9d381673da3dc687ecaecb8083ef5a84099f4b55b1a49.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://michaelgainyo.github.io/">%_</a>
	</div>
	<nav>
		
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<div class="meta">Jan 9, 2023</div>
			<h1 class="title">Dynamic Serialization With Django Rest Framework</h1>
		</div>
		

		<section class="body">
			<p>Suppose we have two django models, <code>Product</code> and <code>Size</code>, defined as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Product</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">99</span>)
</span></span><span style="display:flex;"><span>    description <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>TextField(null<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, blank<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Size</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>    product <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(<span style="color:#e6db74">&#39;Product&#39;</span>, related_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sizes&#39;</span>, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span>    code <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>    text <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>    quantity <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>PositiveIntegerField(default<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span></code></pre></div><p>On a product detail view page, we might want to return a JSON response similar to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Fur Flight Jacket&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Jacket made of textured tear-resistant ripstop fabric&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;sizes&#34;</span>: [
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;xs&#34;</span>, <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Extra-Small&#34;</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">15</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;s&#34;</span>, <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Small&#34;</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">20</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;m&#34;</span>, <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Medium&#34;</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">0</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;l&#34;</span>, <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Large&#34;</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">10</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#f92672">&#34;code&#34;</span>: <span style="color:#e6db74">&#34;xl&#34;</span>, <span style="color:#f92672">&#34;text&#34;</span>: <span style="color:#e6db74">&#34;Extra-Large&#34;</span>, <span style="color:#f92672">&#34;quantity&#34;</span>: <span style="color:#ae81ff">5</span> }
</span></span><span style="display:flex;"><span>  ]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This response includes not only the <code>id</code>, <code>name</code>, and <code>description</code> fields of a product, but also a list of its available sizes.</p>
<p>However, on a product list page, we might prefer a simpler response that only includes the id, name, and description fields, like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>[
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Flight Jacket&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Jacket made of textured tear-resistant ripstop fabric&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Stretch Linen Dress&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;A dress made of stretch linen blend fabric. Halter neck with bead appliqu√©&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Denim Jacket&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Lapel collar jacket with long sleeves with buttoned cuffs&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><p>The easiest, and probably recommended way to handle these two different responses, is to create two separate serializers, <code>ProductListSerializer</code> and <code>ProductDetailSerializer</code>.
For example, ProductListSerializer would be defined like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductListSerializer</span>(serializers<span style="color:#f92672">.</span>ModelSerializer):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
</span></span><span style="display:flex;"><span>        model <span style="color:#f92672">=</span> Product
</span></span><span style="display:flex;"><span>        fields<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;id&#39;</span>,<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>)
</span></span></code></pre></div><p>ProductDetailSerializer would be defined like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductDetailSerializer</span>(serializers<span style="color:#f92672">.</span>ModelSerializer):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
</span></span><span style="display:flex;"><span>        model <span style="color:#f92672">=</span> Product
</span></span><span style="display:flex;"><span>        fields<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;id&#39;</span>,<span style="color:#e6db74">&#39;name&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>,<span style="color:#e6db74">&#39;sizes&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    sizes <span style="color:#f92672">=</span> SizeSerializer(many<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span></code></pre></div><p>Note that ProductDetailSerializer includes the sizes field, which is a list of Size objects related to the Product. Finally, SizeSerializer would look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SizeSerializer</span>(serializers<span style="color:#f92672">.</span>ModelSerializer):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
</span></span><span style="display:flex;"><span>        model <span style="color:#f92672">=</span> Size
</span></span><span style="display:flex;"><span>        fields <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;code&#39;</span>,<span style="color:#e6db74">&#39;text&#39;</span>, <span style="color:#e6db74">&#39;quantity&#39;</span>)
</span></span></code></pre></div><p>Alternatively, we can create these serializers dynamically by taking advantage of the <code>type</code> function which allows you to create a new class dynamically by specifying its name, base classes, and attributes. For example,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_product_serializer_class</span>(<span style="color:#f92672">*</span>, fields:tuple<span style="color:#f92672">=</span>()):
</span></span><span style="display:flex;"><span>    fields <span style="color:#f92672">=</span> fields <span style="color:#f92672">+</span> (<span style="color:#e6db74">&#39;id&#39;</span>, <span style="color:#e6db74">&#39;name&#39;</span>)
</span></span><span style="display:flex;"><span>    attrs <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Meta&#39;</span>: type(<span style="color:#e6db74">&#39;Meta&#39;</span>, (), {<span style="color:#e6db74">&#39;model&#39;</span>: Product,<span style="color:#e6db74">&#39;fields&#39;</span>: fields,})}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;sizes&#34;</span> <span style="color:#f92672">in</span> fields:
</span></span><span style="display:flex;"><span>        attrs[<span style="color:#e6db74">&#39;sizes&#39;</span>] <span style="color:#f92672">=</span> SizeSerializer(many<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, read_only<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> type(<span style="color:#e6db74">&#39;ProductSerializer&#39;</span>, (serializers<span style="color:#f92672">.</span>ModelSerializer,), attrs)
</span></span></code></pre></div><p>This function takes a tuple of fields as an argument and returns a new serializer class with those fields included. For example, we could redefine our previous serializers as such:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>ProductListSerializer <span style="color:#f92672">=</span> get_product_serializer_class(fields<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;description&#39;</span>,))
</span></span><span style="display:flex;"><span>ProductDetailSerializer <span style="color:#f92672">=</span> get_product_serializer_class(fields<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;description&#39;</span>, <span style="color:#e6db74">&#39;sizes&#39;</span>))
</span></span></code></pre></div><p>To use either of these serializers, we simply instantiate the class and pass it a Product instance. For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>product <span style="color:#f92672">=</span> Product<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>print(ProductDetailSerializer(product)<span style="color:#f92672">.</span>data)
</span></span></code></pre></div><p>We can also use it in a view or viewset as such:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductViewset</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span></span><span style="display:flex;"><span>    queryset <span style="color:#f92672">=</span> Product<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>active()
</span></span><span style="display:flex;"><span>    serializer_class <span style="color:#f92672">=</span> ProductSerializer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_serializer_class</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>action <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;list&#39;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> ProductListSerializer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ProductSerializer
</span></span></code></pre></div><p>Or maybe, you want to select the fields based on a request&rsquo;s query parameters</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ProductViewset</span>(viewsets<span style="color:#f92672">.</span>ModelViewSet):
</span></span><span style="display:flex;"><span>    queryset <span style="color:#f92672">=</span> Product<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>active()
</span></span><span style="display:flex;"><span>    serializer_class <span style="color:#f92672">=</span> ProductSerializer
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_serializer_class</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># getattr(request, &#39;query_params&#39;, {})</span>
</span></span><span style="display:flex;"><span>        fields <span style="color:#f92672">=</span> set()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>query_params<span style="color:#f92672">.</span>getlist(<span style="color:#e6db74">&#39;fields&#39;</span>):
</span></span><span style="display:flex;"><span>            fields<span style="color:#f92672">.</span>update(item<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> get_product_serializer_class(fields<span style="color:#f92672">=</span>fields)
</span></span></code></pre></div><p>Keep in mind that using this approach has some disadvantages, such as performance overhead and increased complexity, so it should be used with caution. However, it allows us to create a product serializer for any set of fields we need without having to define a separate class for each combination of fields.</p>

		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/drf">drf</a></li>
					
					<li><a href="/tags/django">django</a></li>
					
					<li><a href="/tags/python">python</a></li>
					
				</ul>
			</nav>
			
			
		</div>
	</article>
</main>
<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/michaelgainyo/" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a><a class="soc" href="https://twitter.com/michaelgainyo/" rel="me" title="Twitter"><i data-feather="twitter"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2023  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
